{
    email {{ caddy.email }}

{% if caddy.logs.enabled | bool %}
    log {
        output file /var/log/caddy/access.log {
            roll_size 10MiB
            roll_keep 5
        }
        format json
    }
{% endif %}

{% if caddy.cloudflare.enabled | bool %}
    acme_dns cloudflare {env.CLOUDFLARE_API_TOKEN} {
        resolvers 1.1.1.1
    }
{% endif %}

{% if caddy.sablier_enabled | bool %}
    order sablier before reverse_proxy
{% endif %}

    servers :443 {
        protocols h1 h2 h3
        listener_wrappers {
            http_redirect
            tls
        }
    }
}
